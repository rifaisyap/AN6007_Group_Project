{% extends "merchant_register/base.html" %}
{% block title %}Merchant Registration{% endblock %}
{% block header_title %}Merchant Registration{% endblock %}


{% block content %}
<form method="post" action="/merchant/registration">

    <!-- Merchant Info -->
    <div class="form-section">
        <h3>Merchant Information</h3>

        <div class="form-grid">
            <div>
                <label for="merchant_name">Merchant Name</label>
                <input type="text" id="merchant_name" name="merchant_name" required>
            </div>

            <div>
                <label for="uen">UEN</label>
                <input
                    type="text"
                    id="uen"
                    name="uen"
                    placeholder="e.g. 201912345K"
                    required
                >
            </div>
        </div>
    </div>

    <!-- Bank Info -->
    <div class="form-section">
        <h3>Bank Details</h3>

        <div class="form-grid">
            <div>
                <label for="bank_name">Bank Name</label>
                <select name="bank_name" id="bank_name" required>
                    <option value="">Select bank</option>
                    {% for bank in banks %}
                        <option
                            value="{{ bank.bank_name }}"
                            data-bank-code="{{ bank.bank_code }}"
                            data-branch-code="{{ bank.branch_code }}"
                        >
                            {{ bank.bank_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="account_number">Account Number</label>
                <input
                    type="text"
                    id="account_number"
                    name="account_number"
                    inputmode="numeric"
                    placeholder="Numbers only"
                    required
                >
                <p class="hint error" id="account_error" style="display:none;">
                    Account number must contain numbers only
                </p>
            </div>

            <div>
                <label for="bank_code">Bank Code</label>
                <input
                    type="text"
                    id="bank_code"
                    name="bank_code"
                    readonly
                    required
                >
            </div>

            <div>
                <label for="branch_code">Branch Code</label>
                <input
                    type="text"
                    id="branch_code"
                    name="branch_code"
                    readonly
                    required
                >
            </div>

            <div>
                <label for="account_holder_name">Account Holder Name</label>
                <input
                    type="text"
                    id="account_holder_name"
                    name="account_holder_name"
                    required
                >
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="form-section">
        <h3>Status</h3>
        <select name="status" required>
            <option value="active">Active</option>
            <option value="pending">Pending</option>
            <option value="suspended">Suspended</option>
        </select>
    </div>

    <!-- Submit -->
    <div class="form-action">
        <button type="submit">Register Merchant</button>
    </div>
</form>

<script>
    // Auto-fill bank & branch code
    const bankSelect = document.getElementById("bank_name");
    const bankCode = document.getElementById("bank_code");
    const branchCode = document.getElementById("branch_code");

    bankSelect.addEventListener("change", function () {
        const opt = this.options[this.selectedIndex];

        if (!opt.value) {
            bankCode.value = "";
            branchCode.value = "";
            return;
        }

        bankCode.value = opt.dataset.bankCode || "";
        branchCode.value = opt.dataset.branchCode || "";
    });

    // Numeric-only helper for account number
    function numericOnly(inputEl, errorEl) {
        inputEl.addEventListener("input", function () {
            const numericValue = this.value.replace(/\D/g, "");

            errorEl.style.display =
                this.value !== numericValue ? "block" : "none";

            this.value = numericValue;
        });
    }

    numericOnly(
        document.getElementById("account_number"),
        document.getElementById("account_error")
    );
</script>
{% endblock %}
