{% extends "merchant_register/base.html" %}
{% block title %}Register Merchant{% endblock %}

{% block content %}
<form method="post" action="/merchant/registration">

    <!-- Merchant Info -->
    <div class="form-section">
        <h3>Merchant Information</h3>

        <div class="form-grid">
            <div>
                <label>Merchant Name</label>
                <input type="text" name="merchant_name" required>
            </div>

            <div>
                <label>UEN</label>
                <input
                    type="text"
                    id="uen"
                    name="uen"
                    inputmode="numeric"
                    placeholder="Numbers only"
                    required
                >
                <p class="hint error" id="uen_error" style="display:none;">
                    UEN must contain numbers only
                </p>
            </div>
        </div>
    </div>

    <!-- Bank Info -->
    <div class="form-section">
        <h3>Bank Details</h3>

        <div class="form-grid">
            <div>
                <label>Bank Name</label>
                <select name="bank_name" id="bank_name" required>
                    <option value="">Select bank</option>
                    {% for bank_name, bank in banks.items() %}
                        <option
                            value="{{ bank_name }}"
                            data-bank-code="{{ bank.bank_code }}"
                            data-branch-code="{{ bank.branch_code }}"
                        >
                            {{ bank_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Account Number</label>
                <input
                    type="text"
                    id="account_number"
                    name="account_number"
                    inputmode="numeric"
                    placeholder="Numbers only"
                    required
                >
                <p class="hint error" id="account_error" style="display:none;">
                    Account number must contain numbers only
                </p>
            </div>

            <div>
                <label>Bank Code</label>
                <input type="text" id="bank_code" name="bank_code" readonly required>
            </div>

            <div>
                <label>Branch Code</label>
                <input type="text" id="branch_code" name="branch_code" readonly required>
            </div>

            <div>
                <label>Account Holder Name</label>
                <input type="text" name="account_holder_name" required>
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="form-section">
        <h3>Status</h3>
        <select name="status" required>
            <option value="active">Active</option>
            <option value="pending">Pending</option>
            <option value="suspended">Suspended</option>
        </select>
    </div>

    <!-- Submit -->
    <div class="form-action">
        <button type="submit">Register Merchant</button>
    </div>
</form>

<script>
    // Bank data - auto fill
    const bankSelect = document.getElementById("bank_name");
    const bankCode = document.getElementById("bank_code");
    const branchCode = document.getElementById("branch_code");

    bankSelect.addEventListener("change", function () {
        const opt = this.options[this.selectedIndex];
        bankCode.value = opt.dataset.bankCode || "";
        branchCode.value = opt.dataset.branchCode || "";
    });

    // Helper for numeric data only
    function numericOnly(inputEl, errorEl) {
        inputEl.addEventListener("input", function () {
            const numericValue = this.value.replace(/\D/g, "");

            if (this.value !== numericValue) {
                errorEl.style.display = "block";
            } else {
                errorEl.style.display = "none";
            }

            this.value = numericValue;
        });
    }

    // UEN validation
    numericOnly(
        document.getElementById("uen"),
        document.getElementById("uen_error")
    );

    // Account number validation
    numericOnly(
        document.getElementById("account_number"),
        document.getElementById("account_error")
    );
</script>
{% endblock %}
